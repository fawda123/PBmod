.[-1] %>%
strsplit('\\t|;')
x <- dat[[1144]]
x
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus', 'species')
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus', 'species')
1
1
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus', 'species')
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus', 'species')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;')
dat <- x[[1]]
x <- dat[[1]]
x
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unnkown or uncultured
lst <- grep('^Unknown|^uncultured', x) %>%
min(.) - 1
lst
grep('^Unknown|^uncultured', x)
grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
x
cls <- grep('unclassified', x)
cls
cls <- grep('unclaasdfasdfsified', x)
cls
length(cls)
cls
cls
cls <- grep('unclassified', x)
cls
taxs[cls - 1]
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
taxs
taxs[cls - 3]
paste(x[cls], unc, sep = '_')
unc <- taxs[cls - 3]
paste(x[cls], unc, sep = '_')
unc <- taxs[cls - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
x
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(unc){
# if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(unk){
# if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highext tax
cls <- grep('unclassified', x)
if(cls){
unc <- taxs[cls - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc)){
# if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(unk){
# if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highext tax
cls <- grep('unclassified', x)
if(cls){
unc <- taxs[cls - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
integer(0)
unkinteger(0)
cls <- grep('unclassified', x)
unc <- taxs[cls - 2]
unc
x[cls] <- paste(x[cls], unc, sep = '_')
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highest tax
cls <- grep('unclassified', x)
if(cls){
unc <- taxs[cls - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highest tax
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[cls - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
warnings()
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highest tax
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
warnings()
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grep('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# fix classified to highest tax
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;')
x <- dat[[1]]
x
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
lst
unc <- which(x %in% 'uncultured')
unc
length(unc)
unk <- grep('Unknown', x)
length(unk) > 0
cls <- grep('unclassified', x)
length(cls) > 0
c ls
cls
unc <- taxs[min(cls) - 2]
unc
paste(x[cls], unc, sep = '_')
x[cls] <- paste(x[cls], unc, sep = '_')
x
length(unc) > 0)
length(unc) > 0
unc
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
browser()
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# append highest tax to unclassified
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
# save output
outfl <- 'L:/public/mbeck/dat.csv'
write.table(dat, outfl, sep = ',', quote = F, row.names = F, col.names = F)
# install.packages(tidyverse)
library(tidyverse)
# file name
fl <- 'L:/Public/KHoughto/Run4_16S_R1.trim.contigs.pick.good.unique.good.filter.unique.precluster.pick.pick.pick.opti_mcc.0.03.cons.taxonomy'
taxs <- c('kingdom', 'phylum', 'class', 'order', 'family', 'genus')
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
browser()
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# append highest tax to unclassified
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
x
c'
'
warnings()
x
x
unc <- which(x %in% 'uncultured')
length(unc) > 0
length(cls) > 0
cls <- grep('unclassified', x)
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
x
x
unc <- which(x %in% 'uncultured')
length(unc) > 0
paste(x[lst], x[unc], sep = '_')
grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
grep('^Unknown|^uncultured', x) %>%
min(.) - 1
grepl('^Unknown|^uncultured', x) %>%
min(.) - 1
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grep('^Unknown|^uncultured', x) %>%
min(.) - 1
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# append highest tax to unclassified
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
warnings()
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- grep('^Unknown|^uncultured', x) %>%
suppressWarnings({min(.) - 1})
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# append highest tax to unclassified
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
# process file
dat <- readLines(fl) %>%
.[-1] %>%
strsplit('\\t|;') %>%
map(., function(x){
# remove extra info
x <- x %>%
gsub('\\([0-9]+\\)$', '', .) %>%
gsub('^(uncultured).*$','\\1', .) %>%
gsub('^(Unknown).*$', '\\1', .)
# find last entry not unkown or uncultured
lst <- suppressWarnings({grep('^Unknown|^uncultured', x) %>%
min(.) - 1
})
# append uncultured labels to higher tax
unc <- which(x %in% 'uncultured')
if(length(unc) > 0){
x[unc] <- paste(x[lst], x[unc], sep = '_')
}
# append uncultured labels to higher tax
unk <- grep('Unknown', x)
if(length(unk) > 0){
x[unk] <- paste(x[lst], x[unk], sep = '_')
}
# append highest tax to unclassified
cls <- grep('unclassified', x)
if(length(cls) > 0){
unc <- taxs[min(cls) - 2]
x[cls] <- paste(x[cls], unc, sep = '_')
}
return(x)
}) %>%
do.call('rbind', .)
dat
outfl <- 'L:/public/mbeck/dat.csv'
write.table(dat, outfl, sep = ',', quote = F, row.names = F, col.names = F)
